#!/usr/bin/env groovy

pipeline {
    agent any
    environment {
        AWS_ACCESS_KEY = credentials('JenkinsUser')
        GOLD_AWS = credentials('gold_key')

        AWS_DEFAULT_REGION = 'us-east-1'
        AWS_ACCESS_KEY_ID = "${AWS_ACCESS_KEY_USR}"
        AWS_SECRET_ACCESS_KEY = "${AWS_ACCESS_KEY_PSW}"
    }
    stages {
        stage('Decommission SMTP 1') {
            steps {
                wrap([$class: 'MaskPasswordsBuildWrapper']) {
                    dir('test-instance') {
                        sh ./decom_smtp1.sh '${OLD_SMPT_1}' '${OLD_SMPT_2}' '${GOLD_AWS_USR}' '${GOLD_AWS_PSW}'/
                    }
                }
            }
        }
    }
}
